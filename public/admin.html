<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理系统 - 消防栓定位与导航系统</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* 管理员页面专用样式 */
        .admin-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .admin-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .admin-welcome {
            font-size: 16px;
            color: #666;
        }

        .admin-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-nav-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .admin-nav-btn.active {
            background: #1677ff;
            color: white;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .user-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .user-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .user-table th {
            background: #f5f5f5;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e8e8e8;
        }

        .user-table td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .user-table tr:hover {
            background: #f9f9f9;
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn {
            background: #1677ff;
            color: white;
        }

        .reset-btn {
            background: #52c41a;
            color: white;
        }

        .delete-btn {
            background: #ff4d4f;
            color: white;
        }

        .status-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .status-active {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }

        .status-inactive {
            background: #fff2f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }

        /* 添加用户表单样式 */
        .add-user-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            margin: 0 auto;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d9d9d9;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn-primary {
            padding: 10px 20px;
            background: #1677ff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-secondary {
            padding: 10px 20px;
            background: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        /* 修改密码弹窗样式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #666;
        }

        .logout-btn {
            background: #ff4d4f;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .back-btn {
            background: #f0f0f0;
            color: #333;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }


        /* Toast提示样式 */
        .result-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-weight: 500;
            z-index: 99999;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .toast-success {
            background: linear-gradient(135deg, #52c41a, #73d13d);
            border-left: 4px solid #389e0d;
        }

        .toast-error {
            background: linear-gradient(135deg, #ff4d4f, #ff7875);
            border-left: 4px solid #cf1322;
        }

        .toast-warning {
            background: linear-gradient(135deg, #faad14, #ffc53d);
            border-left: 4px solid #d48806;
            color: #333;
        }

        .toast-info {
            background: linear-gradient(135deg, #1890ff, #40a9ff);
            border-left: 4px solid #096dd9;
        }
    </style>
</head>

<body>
    <div class="admin-container">
        <!-- 头部 -->
        <div class="admin-header">
            <div>
                <div class="admin-title">用户管理系统</div>
                <div class="admin-welcome">
                    欢迎，<span id="adminName">管理员</span>
                    <button class="back-btn" id="backToMainBtn">返回主系统</button>
                </div>
            </div>
            <button class="logout-btn" id="adminLogoutBtn">退出登录</button>
        </div>

        <!-- 导航 -->
        <div class="admin-nav">
            <button class="admin-nav-btn active" data-content="userList">用户列表</button>
            <button class="admin-nav-btn" data-content="addUser">添加用户</button>
        </div>

        <!-- 用户列表 -->
        <div id="userList" class="admin-content active">
            <div class="user-table">
                <table>
                    <thead>
                        <tr>
                            <th>用户ID</th>
                            <th>账号</th>
                            <th>姓名</th>
                            <th>角色</th>
                            <th>状态</th>
                            <th>创建时间</th>
                            <th>最后登录</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <!-- 用户数据会动态加载到这里 -->
                        <tr id="userLoadingRow">
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                <i class="fa fa-spinner fa-spin"></i> 加载用户数据...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 添加用户 -->
        <div id="addUser" class="admin-content">
            <div class="add-user-form">
                <h3 style="margin-bottom: 30px;">添加新用户</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label for="newUsername">账号 *</label>
                        <input type="text" id="newUsername" placeholder="请输入账号">
                    </div>
                    <div class="form-group">
                        <label for="newRealName">姓名 *</label>
                        <input type="text" id="newRealName" placeholder="请输入姓名">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="newPassword">密码 *</label>
                        <input type="password" id="newPassword" placeholder="请输入密码">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">确认密码 *</label>
                        <input type="password" id="confirmPassword" placeholder="请再次输入密码">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="newRole">用户角色 *</label>
                        <select id="newRole">
                            <option value="firefighter">消防员</option>
                            <option value="collector">采集员</option>
                            <option value="admin">管理员</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newStatus">账号状态</label>
                        <select id="newStatus">
                            <option value="1">启用</option>
                            <option value="0">禁用</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn-secondary" id="cancelAddUser">取消</button>
                    <button class="btn-primary" id="submitAddUser">添加用户</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 修改密码弹窗 -->
    <div class="modal-overlay" id="passwordModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">修改用户密码</div>
                <button class="modal-close" id="closePasswordModal">&times;</button>
            </div>

            <div class="form-group">
                <label for="editUsername">账号</label>
                <input type="text" id="editUsername" readonly>
            </div>

            <div class="form-group">
                <label for="newPasswordForUser">新密码 *</label>
                <input type="password" id="newPasswordForUser" placeholder="请输入新密码">
            </div>

            <div class="form-group">
                <label for="confirmNewPassword">确认新密码 *</label>
                <input type="password" id="confirmNewPassword" placeholder="请再次输入新密码">
            </div>

            <div class="form-actions">
                <button class="btn-secondary" id="cancelPasswordChange">取消</button>
                <button class="btn-primary" id="savePasswordChange">保存</button>
            </div>
        </div>
    </div>

    <!-- 提示信息 -->
    <div class="result-toast" id="adminToast"></div>

    <script>
        // 管理员管理脚本
        const AdminManager = {
            currentUser: null,
            currentToken: null,
            editingUserId: null,
            API_BASE: window.location.hostname === 'localhost' ? 'http://localhost:3000/api' : '/api',

            init() {
                console.log('管理员页面初始化开始...');
                this.checkAuth();
                this.bindEvents();
                this.loadUserList();
                console.log('管理员页面初始化完成');
            },
            // 检查认证状态
            checkAuth() {
                const token = sessionStorage.getItem('admin_token');
                const user = sessionStorage.getItem('admin_user');

                if (!token || !user) {
                    // 未登录，跳回登录页
                    window.location.href = 'index.html';
                    return;
                }

                try {
                    this.currentToken = token;
                    this.currentUser = JSON.parse(user);

                    // 验证是否为管理员
                    if (this.currentUser.role !== 'admin') {
                        this.showToast('无权限访问管理页面');
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 2000);
                        return;
                    }

                    // 显示管理员姓名
                    document.getElementById('adminName').textContent =
                        this.currentUser.realName || this.currentUser.username;

                } catch (error) {
                    console.error('认证检查失败:', error);
                    window.location.href = 'index.html';
                }
            },

            // 绑定事件
            bindEvents() {
                console.log('绑定管理员页面事件...');

                // 导航切换
                document.querySelectorAll('.admin-nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const target = e.target.dataset.content;

                        // 更新导航按钮状态
                        document.querySelectorAll('.admin-nav-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        btn.classList.add('active');

                        // 更新内容显示
                        document.querySelectorAll('.admin-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        document.getElementById(target).classList.add('active');
                    });
                });

                // 退出登录
                document.getElementById('adminLogoutBtn').addEventListener('click', () => {
                    this.logout();
                });

                // 返回主系统
                document.getElementById('backToMainBtn').addEventListener('click', () => {
                    sessionStorage.removeItem('admin_token');
                    sessionStorage.removeItem('admin_user');
                    window.location.href = 'index.html';
                });

                // 添加用户 - 确保正确绑定
                const submitAddUserBtn = document.getElementById('submitAddUser');
                if (submitAddUserBtn) {
                    // 先移除旧的监听器（避免重复绑定）
                    submitAddUserBtn.removeEventListener('click', this.addUser.bind(this));
                    // 绑定新的监听器
                    submitAddUserBtn.addEventListener('click', () => {
                        console.log('添加用户按钮被点击');
                        this.addUser();
                    });
                }

                // 取消添加用户
                const cancelAddUserBtn = document.getElementById('cancelAddUser');
                if (cancelAddUserBtn) {
                    cancelAddUserBtn.addEventListener('click', () => {
                        document.querySelector('.admin-nav-btn[data-content="userList"]').click();
                        this.resetAddUserForm();
                    });
                }

                // 修改密码弹窗
                document.getElementById('closePasswordModal').addEventListener('click', () => {
                    this.closePasswordModal();
                });

                document.getElementById('cancelPasswordChange').addEventListener('click', () => {
                    this.closePasswordModal();
                });

                document.getElementById('savePasswordChange').addEventListener('click', () => {
                    this.savePasswordChange();
                });

                // 密码输入框回车提交
                document.getElementById('newPasswordForUser').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.savePasswordChange();
                    }
                });

                console.log('管理员页面事件绑定完成');
            },

            // 加载用户列表
            async loadUserList() {
                try {
                    const response = await fetch(`${this.API_BASE}/admin/users`, {
                        headers: {
                            'Authorization': `Bearer ${this.currentToken}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.renderUserTable(data.data);
                    } else {
                        this.showToast(data.message || '加载用户列表失败');
                    }
                } catch (error) {
                    console.error('加载用户列表失败:', error);
                    this.showToast('网络错误，请稍后重试');
                }
            },

            // 渲染用户表格
            renderUserTable(users) {
                const tbody = document.getElementById('userTableBody');

                if (!users || users.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px;">
                                暂无用户数据
                            </td>
                        </tr>
                    `;
                    return;
                }

                let html = '';

                users.forEach(user => {
                    // 格式化时间
                    const formatTime = (timeStr) => {
                        if (!timeStr) return '从未登录';
                        try {
                            const date = new Date(timeStr);
                            return date.toLocaleString('zh-CN');
                        } catch (e) {
                            return timeStr;
                        }
                    };

                    // 角色显示
                    const roleMap = {
                        'admin': '管理员',
                        'firefighter': '消防员',
                        'collector': '采集员'
                    };

                    html += `
                        <tr data-user-id="${user.id}">
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.real_name || '--'}</td>
                            <td>${roleMap[user.role] || user.role}</td>
                            <td>
                                <span class="status-badge ${user.status === 1 ? 'status-active' : 'status-inactive'}">
                                    ${user.status === 1 ? '启用' : '禁用'}
                                </span>
                            </td>
                            <td>${formatTime(user.created_at)}</td>
                            <td>${formatTime(user.last_login_at)}</td>
                            <td>
                                <div class="user-actions">
                                    <button class="action-btn edit-btn" onclick="AdminManager.editUserPassword(${user.id}, '${user.username}')">
                                        改密
                                    </button>
                                    <button class="action-btn reset-btn" onclick="AdminManager.resetUserStatus(${user.id}, ${user.status === 1 ? 0 : 1})">
                                        ${user.status === 1 ? '禁用' : '启用'}
                                    </button>
                                    ${user.id !== this.currentUser.id ? `
                                    <button class="action-btn delete-btn" onclick="AdminManager.deleteUser(${user.id}, '${user.username}')">
                                        删除
                                    </button>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;
            },

            // 添加用户
            async addUser() {
                console.log('开始执行添加用户...');

                const username = document.getElementById('newUsername').value.trim();
                const realName = document.getElementById('newRealName').value.trim();
                const password = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                const role = document.getElementById('newRole').value;
                const status = parseInt(document.getElementById('newStatus').value);

                console.log('表单数据:', { username, realName, password, confirmPassword, role, status });

                // 验证输入 - 添加详细提示
                if (!username || !password || !realName) {
                    this.showToast('请填写所有必填项', 'warning');
                    return;
                }

                // 检查用户名格式
                if (username.length < 3) {
                    this.showToast('用户名至少需要3个字符', 'warning');
                    return;
                }

                if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                    this.showToast('用户名只能包含字母、数字和下划线', 'warning');
                    return;
                }

                // 检查密码
                if (password.length < 6) {
                    this.showToast('密码长度至少6位', 'warning');
                    return;
                }

                if (password !== confirmPassword) {
                    this.showToast('两次输入的密码不一致，请重新输入', 'error');
                    // 清空密码框让用户重新输入
                    document.getElementById('newPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                    document.getElementById('newPassword').focus();
                    return;
                }

                // 检查密码强度（可选）
                if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(password)) {
                    this.showToast('建议密码包含字母和数字组合', 'warning');
                    // 这里只是建议，不阻止提交
                }

                // 显示加载中
                this.showToast('正在添加用户...', 'info');

                try {
                    console.log('发送添加用户请求...');
                    const response = await fetch(`${this.API_BASE}/admin/users`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.currentToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            username,
                            real_name: realName,
                            password,
                            role,
                            status
                        })
                    });

                    console.log('响应状态:', response.status);
                    const data = await response.json();
                    console.log('响应数据:', data);

                    if (data.success) {
                        this.showToast(`用户 "${username}" 添加成功！`, 'success');
                        this.resetAddUserForm();

                        // 刷新用户列表
                        await this.loadUserList();

                        // 切换到用户列表
                        setTimeout(() => {
                            document.querySelector('.admin-nav-btn[data-content="userList"]').click();
                        }, 1000);
                    } else {
                        this.showToast(data.message || '添加失败', 'error');
                    }
                } catch (error) {
                    console.error('添加用户失败:', error);
                    this.showToast('网络错误，请稍后重试', 'error');
                }
            },

            // 重置添加用户表单
            resetAddUserForm() {
                document.getElementById('newUsername').value = '';
                document.getElementById('newRealName').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                document.getElementById('newRole').value = 'firefighter';
                document.getElementById('newStatus').value = '1';
            },

            // 打开修改密码弹窗
            editUserPassword(userId, username) {
                this.editingUserId = userId;
                document.getElementById('editUsername').value = username;
                document.getElementById('newPasswordForUser').value = '';
                document.getElementById('confirmNewPassword').value = '';
                document.getElementById('passwordModal').classList.add('show');
            },

            // 关闭修改密码弹窗
            closePasswordModal() {
                document.getElementById('passwordModal').classList.remove('show');
                this.editingUserId = null;
            },

            // 保存密码修改
            async savePasswordChange() {
                console.log('保存密码修改...');

                const newPassword = document.getElementById('newPasswordForUser').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;

                // 验证密码 - 添加详细提示
                if (!newPassword) {
                    this.showToast('请输入新密码', 'warning');
                    document.getElementById('newPasswordForUser').focus();
                    return;
                }

                if (newPassword.length < 6) {
                    this.showToast('密码长度至少6位', 'warning');
                    document.getElementById('newPasswordForUser').focus();
                    return;
                }

                if (newPassword !== confirmPassword) {
                    this.showToast('两次输入的密码不一致，请重新输入', 'error');
                    // 清空密码框让用户重新输入
                    document.getElementById('newPasswordForUser').value = '';
                    document.getElementById('confirmNewPassword').value = '';
                    document.getElementById('newPasswordForUser').focus();
                    return;
                }

                // 检查密码强度（可选）
                if (!/(?=.*[a-zA-Z])(?=.*\d)/.test(newPassword)) {
                    this.showToast('建议密码包含字母和数字组合以提高安全性', 'warning');
                    // 这里只是建议，不阻止提交
                }

                // 显示加载中
                this.showToast('正在修改密码...', 'info');

                try {
                    const response = await fetch(`${this.API_BASE}/admin/users/${this.editingUserId}/password`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${this.currentToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            newPassword
                        })
                    });

                    const data = await response.json();
                    console.log('修改密码响应数据:', data);

                    if (data.success) {
                        const username = document.getElementById('editUsername').value;
                        this.showToast(`用户 "${username}" 的密码修改成功！`, 'success');
                        this.closePasswordModal();

                        // 清空表单
                        document.getElementById('newPasswordForUser').value = '';
                        document.getElementById('confirmNewPassword').value = '';
                    } else {
                        this.showToast(data.message || '修改失败', 'error');
                    }
                } catch (error) {
                    console.error('修改密码失败:', error);
                    this.showToast('网络错误，请稍后重试', 'error');
                }
            },

            // 重置用户状态（启用/禁用）
            async resetUserStatus(userId, newStatus) {
                const action = newStatus === 1 ? '启用' : '禁用';
                const username = this.getUsernameById(userId);

                if (!confirm(`确定要${action}用户 "${username}" 吗？`)) {
                    return;
                }

                // 显示加载中
                this.showToast(`正在${action}用户...`, 'info');

                try {
                    const response = await fetch(`${this.API_BASE}/admin/users/${userId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${this.currentToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            status: newStatus
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.showToast(`用户 "${username}" 已${action}！`, 'success');
                        await this.loadUserList(); // 刷新列表
                    } else {
                        this.showToast(data.message || `${action}失败`, 'error');
                    }
                } catch (error) {
                    console.error('修改用户状态失败:', error);
                    this.showToast('网络错误，请稍后重试', 'error');
                }
            },

            // 删除用户
            async deleteUser(userId, username) {
                if (!confirm(`确定要删除用户 "${username}" 吗？\n\n⚠️ 警告：此操作不可恢复！`)) {
                    return;
                }

                if (userId === this.currentUser.id) {
                    this.showToast('不能删除当前登录的用户', 'error');
                    return;
                }

                // 显示加载中
                this.showToast('正在删除用户...', 'info');

                try {
                    const response = await fetch(`${this.API_BASE}/admin/users/${userId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${this.currentToken}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        this.showToast(`用户 "${username}" 删除成功！`, 'success');
                        await this.loadUserList(); // 刷新列表
                    } else {
                        this.showToast(data.message || '删除失败', 'error');
                    }
                } catch (error) {
                    console.error('删除用户失败:', error);
                    this.showToast('网络错误，请稍后重试', 'error');
                }
            },

            // 辅助函数：根据ID获取用户名
            getUsernameById(userId) {
                const userRow = document.querySelector(`tr[data-user-id="${userId}"]`);
                if (userRow) {
                    const usernameCell = userRow.cells[1];
                    return usernameCell.textContent.trim();
                }
                return '未知用户';
            },

            // 退出登录
            logout() {
                // 清除所有存储
                sessionStorage.removeItem('admin_token');
                sessionStorage.removeItem('admin_user');
                localStorage.removeItem('fire_hydrant_token');
                localStorage.removeItem('fire_hydrant_user');

                // 跳转到登录页
                window.location.href = 'index.html';
            },

            // 显示提示
            showToast(message, type = 'info') {
                const toast = document.getElementById('adminToast');
                if (!toast) return;

                // 清除之前的定时器
                if (this.toastTimer) {
                    clearTimeout(this.toastTimer);
                    this.toastTimer = null;
                }

                // 设置消息和样式
                toast.textContent = message;

                // 根据类型设置样式
                toast.className = 'result-toast';
                if (type === 'success') {
                    toast.classList.add('toast-success');
                } else if (type === 'error') {
                    toast.classList.add('toast-error');
                } else if (type === 'warning') {
                    toast.classList.add('toast-warning');
                }

                // 显示并淡入
                toast.style.display = 'block';
                toast.style.opacity = '1';

                // 3秒后淡出并隐藏
                this.toastTimer = setTimeout(() => {
                    toast.style.opacity = '0';

                    // 等淡出动画完成后隐藏
                    setTimeout(() => {
                        toast.style.display = 'none';
                        // 移除样式类
                        toast.classList.remove('toast-success', 'toast-error', 'toast-warning');
                    }, 300);
                }, 3000);
            },
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            AdminManager.init();
        });
    </script>
</body>

</html>